% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis_Enrichment.R
\name{fit.enrichment}
\alias{fit.enrichment}
\title{Assess Cluster Enrichment using a Permutation Test}
\usage{
fit.enrichment(mod, BIC = NULL, n.clust = NULL, nrep = 100, seed)
}
\arguments{
\item{mod}{The fitted model object from \code{mclust::Mclust}.}

\item{BIC}{Optional. An \code{mclustBIC} object. If provided, \code{Mclust} is run on permuted data using this to select the number of clusters.}

\item{n.clust}{The number of clusters to fit on the permuted data. Used if \code{BIC} is \code{NULL}.}

\item{nrep}{The number of permutations to perform to build the null distribution.}

\item{seed}{A random seed for reproducibility of the GMM fitting on permuted data.}
}
\value{
A list containing:
\item{rho_obs}{A vector of the observed densities at each original cluster centroid.}
\item{rho_perm}{A matrix of densities from the permutation test (rows are permutations, columns are clusters).}
\item{rho_rel}{A vector of the relative enrichment scores for each cluster.}
\item{pvalues}{A vector of empirical p-values for each cluster.}
}
\description{
Performs a permutation-based statistical test to evaluate the
enrichment (i.e., local density) of each cluster centroid from a GMM.
}
\details{
This function provides a statistical assessment of how "real" each cluster is. A robust cluster is expected to form in a region of high data density. This function tests whether the density at each observed cluster centroid is significantly higher than what would be expected by chance.

The statistical procedure is as follows:
\enumerate{
\item \strong{Observed Density}: For the original fitted model (\code{mod}), it calculates the probability density ($\rho_{obs}$) at the location of each cluster's centroid using the estimated GMM parameters.
\item \strong{Permutation (Null Distribution)}: It generates a null distribution for the density. This is done by:
a.  Creating \code{nrep} permuted datasets. In each, the values within the data matrix are randomly shuffled, breaking any real structure.
b.  For each permuted dataset, a new GMM is fitted with the same specifications (number of clusters, model name).
c.  The density ($\rho_{perm}$) is calculated at the locations of the \emph{original} centroids using the parameters from the model fitted to the \emph{permuted} data.
\item \strong{Enrichment and p-value}:
\itemize{
\item The relative enrichment ($\rho_{rel}$) for each cluster is the ratio of the observed density to the mean of the densities from the null distribution: $\rho_{rel} = \rho_{obs} / \text{mean}(\rho_{perm})$. A value > 1 suggests the cluster is in a denser-than-random region.
\item An empirical p-value is calculated for each cluster as the proportion of permutations where the permuted density was greater than or equal to the observed density. This represents the probability of observing such a high density by chance alone. A low p-value suggests the cluster is statistically significant.
}
}
}
