% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis_FA.R
\name{analysis.FA}
\alias{analysis.FA}
\title{Perform First and Second-Order Factor Analysis}
\usage{
analysis.FA(X, ID, nfactors = NULL, nfactors2 = NULL, filename = NULL)
}
\arguments{
\item{X}{A numeric matrix or data frame of the observed variables (e.g., item responses).}

\item{ID}{A vector of identifiers for each row in \code{X}.}

\item{nfactors}{An optional integer specifying the number of first-order factors. If \code{NULL} (the default), it is determined automatically via parallel analysis.}

\item{nfactors2}{An optional integer specifying the number of second-order factors. If \code{NULL} (the default), the second-order analysis is skipped.}

\item{filename}{A base string for the output PDF file names (e.g., scree plots, diagrams).}
}
\value{
A list containing:
\item{ID}{The input identifier vector.}
\item{X}{The original input data matrix.}
\item{Xnew}{A matrix of the final factor scores. This will be the first-order factor scores if \code{nfactors2} is NULL, or the second-order factor scores otherwise.}
\item{console}{A placeholder for console output (currently not used).}
}
\description{
Conducts a comprehensive factor analysis workflow, including data
suitability tests, determination of the number of factors, fitting a first-order
model, and optionally fitting a second-order (hierarchical) model.
}
\details{
This function automates the key steps of Exploratory Factor Analysis (EFA),
a statistical method used to uncover the underlying latent structure (factors)
from a set of observed variables.

The workflow consists of three main parts:
\enumerate{
\item \strong{Assessing Factorability}: Before fitting a model, the function assesses whether the data is suitable for factor analysis using two standard statistical tests:
\itemize{
\item \strong{Kaiser-Meyer-Olkin (KMO) Test}: Calculates the Measure of Sampling Adequacy (MSA). The KMO index represents the ratio of the squared correlation between variables to the squared partial correlation between variables. A value of 0.6 or higher is generally considered acceptable for factor analysis.
\item \strong{Bartlett's Test of Sphericity}: This tests the null hypothesis that the correlation matrix is an identity matrix (i.e., variables are unrelated). A significant p-value (e.g., < 0.05) is required, indicating that the variables are sufficiently intercorrelated to be factored.
}
\item \strong{Determining the Number of Factors}: The function uses Parallel Analysis (\code{psych::fa.parallel}), a robust method for determining the number of factors to retain. This method compares the eigenvalues of the actual data to the eigenvalues from simulated random data. Factors are retained if their eigenvalues are greater than those from the corresponding random data. A scree plot is generated to visualize this. If \code{nfactors} is not specified, the function defaults to using the Kaiser criterion (retaining factors with eigenvalues > 1).
\item \strong{Model Fitting and Score Extraction}:
\itemize{
\item \strong{First-Order Model}: A primary factor model is fitted using Principal Axis Factoring (\code{fm="pa"}), which is a common EFA extraction method. An oblique rotation (\code{rotate="oblimin"}) is used, which allows the extracted factors to be correlated. This is often theoretically appropriate in social sciences. The function then calculates factor scores, which are estimates of each individual's standing on the latent factors.
\item \strong{Second-Order Model (Optional)}: If \code{nfactors2} is specified, a hierarchical factor analysis is performed using \code{psych::fa.multi}. This technique treats the first-order factors as indicators to uncover a higher-level, more general latent structure. The final \code{Xnew} object will then contain the scores for these second-order factors.
}
}

The function saves diagnostic plots (scree plot, factor diagrams) as PDF files and returns the final factor scores, which can be used as input for subsequent analyses like clustering or regression.
}
\seealso{
\code{\link[psych]{fa}}, \code{\link[psych]{fa.parallel}}, \code{\link[psych]{fa.multi}}, \code{\link[psych]{KMO}}
}
